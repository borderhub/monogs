# Cloudflare Workers 設定 (OpenNext Cloudflare)
# 環境: preview / production

compatibility_date = "2025-12-25"
compatibility_flags = ["nodejs_compat"]
main = ".open-next/worker.js"

# 静的アセットは .open-next/assets から自動的に配信されます
[assets]
directory = ".open-next/assets"

# ===========================================
# プレビュー環境
# ===========================================
[env.preview]
name = "preview"

# カスタムドメイン設定
[[env.preview.routes]]
pattern = "preview.hoge.net"
custom_domain = true

[env.preview.vars]
NODE_ENV = "preview"
STORAGE_TYPE = "r2"
DB_TYPE = "d1"
NEXTAUTH_URL = "https://preview.hoge.net"
NEXT_PUBLIC_IMAGES_URL = "https://images-preview.hoge.net"

[[env.preview.d1_databases]]
binding = "DB"
database_name = "hoge-db-preview"
database_id = "xxxxxx-xxxx-xxxx"
migrations_dir = "drizzle/migrations"

[[env.preview.r2_buckets]]
binding = "IMAGES"
bucket_name = "hoge-r2-preview"

# ===========================================
# プロダクション環境 (production)
# ===========================================
[env.production]
name = "hoge-production"

# カスタムドメイン設定
[[env.production.routes]]
pattern = "hoge.net"
custom_domain = true

[env.production.vars]
NODE_ENV = "production"
STORAGE_TYPE = "r2"
DB_TYPE = "d1"
NEXTAUTH_URL = "https://hoge.net"
NEXT_PUBLIC_IMAGES_URL = "https://images.hoge.net"

[[env.production.d1_databases]]
binding = "DB"
database_name = "hoge-db"
database_id = "zzzzzzz-zzzz-zzzz-zzzz"
migrations_dir = "drizzle/migrations"

[[env.production.r2_buckets]]
binding = "IMAGES"
bucket_name = "hoge-r2-upload"
