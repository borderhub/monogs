# Cloudflare Workers 設定 (OpenNext Cloudflare)
# 環境: preview / production

compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]
main = ".open-next/worker.js"

# 静的アセットは .open-next/assets から自動的に配信されます
[assets]
directory = ".open-next/assets"

# ===========================================
# プレビュー環境 (monogs-preview)
# ===========================================
[env.preview]
name = "monogs-preview"

[env.preview.vars]
NODE_ENV = "preview"
STORAGE_TYPE = "r2"
DB_TYPE = "d1"
NEXTAUTH_URL = "https://monogs-preview.shirabegroup.workers.dev"
NEXT_PUBLIC_IMAGES_URL = "https://images-preview.monogs.net"
routes = [
  { pattern = "preview.monogs.net/*", custom_domain = true }
]

[[env.preview.d1_databases]]
binding = "DB"
database_name = "monogs-db-preview"
database_id = "5565ffae-d186-4991-9893-c83f5203a6c5"
migrations_dir = "drizzle/migrations"

[[env.preview.r2_buckets]]
binding = "IMAGES"
bucket_name = "monogs-r2-preview"

# ===========================================
# プロダクション環境 (monogs-production)
# ===========================================
[env.production]
name = "monogs-production"

[env.production.vars]
NODE_ENV = "production"
STORAGE_TYPE = "r2"
DB_TYPE = "d1"
NEXTAUTH_URL = "https://monogs-production.shirabegroup.workers.dev"
NEXT_PUBLIC_IMAGES_URL = "https://images.monogs.net"
routes = [
  { pattern = "monogs.net/*", custom_domain = true }
]

[[env.production.d1_databases]]
binding = "DB"
database_name = "monogs-db"
database_id = "d7781133-52aa-41f4-8a30-af1e6c0934b4"
migrations_dir = "drizzle/migrations"

[[env.production.r2_buckets]]
binding = "IMAGES"
bucket_name = "monogs-r2-upload"
